<div class="entry-content">
			<p>Recently, I added a login component to my blog website, to allow the users to see who are the commenters of the posts. For this particular part of the project – including saving, retrieving the user information, as well as saving and deleting the comments I used mocha framework for testing the CRUD operations on the MongoDB. </p>
<p>There are 2 ways to test asynchronous code using Mocha. However if you are not careful just like what I first experienced, you may run into the problem of seeing test result that never fail. In this article, I will talk about how to prevent it from happening. Note all of my node.js test cases for the MongoDB data access layer can be found 
	<a href="https://github.com/c9lu/Blog/blob/master/test/mongoapi_test.js"> here</a>.</p>
<p>The first way to test asynchronous code via Mocha is using the ‘done’ callback.&nbsp; The “done” parameter when passed to beforeEach() or it() etc &#8211; tells Mocha that your test&nbsp; is asynchronous and it should wait for the asynchronous code to complete.&nbsp; By calling the done method in the callback function, it will ensures the entire 
function will be executed. If you don’t call the done function, you might run into problem of your assertion code (if the asynchrous code takes more than the default timeout period) never being executed, and that leads to false positive tests.</p>
<p>The mocha framework makes testing asynchronous code with promise quite easy since it comes with built in promise support without using the done callback. However, mind you it could also easily lead to test that never fail if you are not careful. The key is that the test must<font> <strong>return</strong></font> a promise.&nbsp; 
As seen below, if the return keywords are not there, then the code block inside .then() will not be executed, which means it would lead to false positive tests as well.</p>
<p>&nbsp;<a href="https://c9lu508.files.wordpress.com/2017/08/image.png"><img title="image" style="background-image:none;padding-top:0;padding-left:0;display:inline;padding-right:0;border-width:0;" border="0" alt="image" src="https://c9lu508.files.wordpress.com/2017/08/image_thumb.png?w=584&#038;h=519" width="584" height="519"></a></p>
<p>As an alternative, Chai as Promised provides a shortcut and cleaner look&nbsp; for testing with promise, since it allows you to validate the promise result outside of the .then():</p>
<p><a href="https://c9lu508.files.wordpress.com/2017/08/image1.png"><img title="image" style="background-image:none;padding-top:0;padding-left:0;display:inline;padding-right:0;border-width:0;" border="0" alt="image" src="https://c9lu508.files.wordpress.com/2017/08/image_thumb1.png?w=584&#038;h=245" width="584" height="245"></a></p>
					</div><!-- .entry-content -->