<div class="entry-content">
<p>Wow, it has been 2 years since I posted on this blog, time flies.</p>
<p>Currently I am in the process of preparing for my Microsoft C# certification, it is a lot tougher than I expected, as it covers on a lot of materials which I had not been exposed to. However it is great chance to learn tons of new things and share them with you.<br />
So to start off, today I will be discussing about ThreadStatic and ThreadLocal. <br />
As we know each thread has its own call stack that stores its own local variables. At the same time, a thread can also have its own data that is not a local variable. By marking a field with the ThreadStatic attribute, each thread gets its own copy of a field. Below I will show you what I mean:</p>
<p><a href="https://c9lu508.files.wordpress.com/2014/04/image.png"><img title="image" style="border-top:0;border-right:0;border-bottom:0;border-left:0;display:inline;" border="0" alt="image" src="https://c9lu508.files.wordpress.com/2014/04/image_thumb.png" width="516" height="548"></a></p>
<p>The output of this program is bye, Good Afternoon, hello. Without the ThreadStatic attribute on top of the mystring variable,&nbsp; the output will be unpredictable. One of the threads might get the copy of the mystring from another thread, which will cause the output to repeat.</p>
<p>However ThreadStatic has its shortcomings. One is that it doesn’t work with instance fields. So if mystring is an instance field, it would have outputted the same thing as if without the ThreadStatic attribute. Second, if you initialize the static field to some value, the second thread that access the field will not even print anything <em>unless</em> mystring is reassigned in the SecondThreadMethod function as in the example above. And this is because such initialization only occurs once and affects only one thread, so the second thread receives a value of null for the field mystring.</p>
<p>And this is where ThreadLocal&lt;T&gt; comes in.&nbsp; In the program below, the variable mystring is an instance field. Because mystring is declared as ThreadLocal&lt;T&gt;, both the main thread and the second thread have its own copy of the field, thus the output is different from the 2 methods, one says “hello” (from InstanceMethod at its second print statement) and one says “bye” (from Main method). Also before mystring gets reassigned in the InstanceMethod, the second thread does initialize its value to “bye” rather than receiving a value of null, which is a different behaviour to ThreadStatic attribute mentioned earlier.</p>
<p><a href="https://c9lu508.files.wordpress.com/2014/04/image5.png"><img title="image" style="border-top:0;border-right:0;border-bottom:0;border-left:0;display:inline;" border="0" alt="image" src="https://c9lu508.files.wordpress.com/2014/04/image_thumb3.png" width="517" height="301"></a></p>
<p>And as for the type static ThreadLocal&lt;T&gt;, it means all instances of the ThreadLocalTest class share this field. Yet for each thread that access the value of mystring, it receives a unique copy of the field.</p>
<p><a href="https://c9lu508.files.wordpress.com/2014/04/image2.png"></a>&nbsp;</p>
<p><a href="https://c9lu508.files.wordpress.com/2014/04/image3.png"></a></p>
</div>